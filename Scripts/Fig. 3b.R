library(tcltk)
library(tcltk2)
library(permute)
library(lattice)
library(vegan)
library(vegan3d)
library(rgl)
library(BiodiversityR)

otu <- read.delim('data_xxx.txt', row.names = 1, sep = '\t', stringsAsFactors = FALSE, check.names = FALSE)
otu <- t(otu)

group <- read.delim(file = "group_rank.txt")
group <- factor(group$Comb, levels=c('BS', 'RS', 'BCL', 'BCM', 'BCH', 'RCL', 'RCM', 'RCH'))

otu_relative <- otu / rowSums(otu) 
rank_dat <- data.frame()
for (i in rownames(otu_relative)) {
  rank_dat_i <- data.frame(rankabundance(subset(otu_relative, rownames(otu_relative) == i), digits = 8))[1:2]
  rank_dat_i$sample <- i
  rank_dat <- rbind(rank_dat, rank_dat_i)
}
rank_dat <- subset(rank_dat, abundance != 0)

library(ggplot2)

ggplot(rank_dat, aes(rank, log(abundance, 10), color = sample)) +
  scale_colour_manual(limits = c('BS', 'RS', 'BL1', 'BL2', 'BL3', 'BL4', 'BL5', 'BL6', 'BL7', 'BL8', 'BL9', 'BL10', 'BL11', 'BL12', 'BL13', 'BL14', 'BL15', 'BL16', 'BL17', 'BL18', 'BL19', 'BL20', 'BL21', 'BL22', 'BL23', 'BL24', 'BL25', 'BL26', 'BL27', 'BL28', 'BL29', 'BL30', 'BL31', 'BL32', 'BL33', 'BL34', 'BL35', 'BL36', 'BL37', 'BL38', 'BL39', 'BL40', 'BL41', 'BL42', 'BL43', 'BL44', 'BL45', 'BL46', 'BL47', 'BL48', 'BL49', 'BL50', 'BL51', 'BL52', 'BL53', 'BL54', 'BL55', 'BL56', 'BL57', 'BL58', 'BL59', 'BL60', 'BM1', 'BM2', 'BM3', 'BM4', 'BM5', 'BM6', 'BM7', 'BM8', 'BM9', 'BM10', 'BM11', 'BM12', 'BM13', 'BM14', 'BM15', 'BM16', 'BM17', 'BM18', 'BM19', 'BM20', 'BM21', 'BM22', 'BM23', 'BM24', 'BM25', 'BM26', 'BM27', 'BM28', 'BM29', 'BM30', 'BM31', 'BM32', 'BM33', 'BM34', 'BM35', 'BM36', 'BM37', 'BM38', 'BM39', 'BM40', 'BM41', 'BM42', 'BM43', 'BM44', 'BM45', 'BM46', 'BM47', 'BM48', 'BM49', 'BM50', 'BM51', 'BM52', 'BM53', 'BM54', 'BM55', 'BM56', 'BM57', 'BM58', 'BM59', 'BM60', 'BH1', 'BH2', 'BH3', 'BH4', 'BH5', 'BH6', 'BH7', 'BH8', 'BH9', 'BH10', 'BH11', 'BH12', 'BH13', 'BH14', 'BH15', 'BH16', 'BH17', 'BH18', 'BH19', 'BH20', 'BH21', 'BH22', 'BH23', 'BH24', 'BH25', 'BH26', 'BH27', 'BH28', 'BH29', 'BH30', 'BH31', 'BH32', 'BH33', 'BH34', 'BH35', 'BH36', 'BH37', 'BH38', 'BH39', 'BH40', 'BH41', 'BH42', 'BH43', 'BH44', 'BH45', 'BH46', 'BH47', 'BH48', 'BH49', 'BH50', 'BH51', 'BH52', 'BH53', 'BH54', 'BH55', 'BH56', 'BH57', 'BH58', 'BH59', 'BH60', 'RL1', 'RL2', 'RL3', 'RL4', 'RL5', 'RL6', 'RL7', 'RL8', 'RL9', 'RL10', 'RL11', 'RL12', 'RL13', 'RL14', 'RL15', 'RL16', 'RL17', 'RL18', 'RL19', 'RL20', 'RL21', 'RL22', 'RL23', 'RL24', 'RL25', 'RL26', 'RL27', 'RL28', 'RL29', 'RL30', 'RL31', 'RL32', 'RL33', 'RL34', 'RL35', 'RL36', 'RL37', 'RL38', 'RL39', 'RL40', 'RL41', 'RL42', 'RL43', 'RL44', 'RL45', 'RL46', 'RL47', 'RL48', 'RL49', 'RL50', 'RL51', 'RL52', 'RL53', 'RL54', 'RL55', 'RL56', 'RL57', 'RL58', 'RL59', 'RL60', 'RM1', 'RM2', 'RM3', 'RM4', 'RM5', 'RM6', 'RM7', 'RM8', 'RM9', 'RM10', 'RM11', 'RM12', 'RM13', 'RM14', 'RM15', 'RM16', 'RM17', 'RM18', 'RM19', 'RM20', 'RM21', 'RM22', 'RM23', 'RM24', 'RM25', 'RM26', 'RM27', 'RM28', 'RM29', 'RM30', 'RM31', 'RM32', 'RM33', 'RM34', 'RM35', 'RM36', 'RM37', 'RM38', 'RM39', 'RM40', 'RM41', 'RM42', 'RM43', 'RM44', 'RM45', 'RM46', 'RM47', 'RM48', 'RM49', 'RM50', 'RM51', 'RM52', 'RM53', 'RM54', 'RM55', 'RM56', 'RM57', 'RM58', 'RM59', 'RM60', 'RH1', 'RH2', 'RH3', 'RH4', 'RH5', 'RH6', 'RH7', 'RH8', 'RH9', 'RH10', 'RH11', 'RH12', 'RH13', 'RH14', 'RH15', 'RH16', 'RH17', 'RH18', 'RH19', 'RH20', 'RH21', 'RH22', 'RH23', 'RH24', 'RH25', 'RH26', 'RH27', 'RH28', 'RH29', 'RH30', 'RH31', 'RH32', 'RH33', 'RH34', 'RH35', 'RH36', 'RH37', 'RH38', 'RH39', 'RH40', 'RH41', 'RH42', 'RH43', 'RH44', 'RH45', 'RH46', 'RH47', 'RH48', 'RH49', 'RH50', 'RH51', 'RH52', 'RH53', 'RH54', 'RH55', 'RH56', 'RH57', 'RH58', 'RH59', 'RH60'), 
                      values = c('#DA5F00', '#149F78', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#6EA2DB', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#45A8AC', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#DC8F95', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#377EB8', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#4DAF4A', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C', '#E41A1C')) +
  geom_line(size = 0.6, alpha = 0.7)+
  labs(x = 'ASVs rank', y = 'Relative adundance (%)', color = NULL) +
  theme(panel.grid = element_blank(), panel.background = element_rect(fill = 'transparent', color = 'black'), legend.key = element_rect(fill = 'transparent')) +
  scale_y_continuous(breaks = 0:-5, labels = c('100', '10', '1', '0.1', '0.01', '0.001'), limits = c(-5, 0))+
  theme(legend.text = element_text(size = 5),
        legend.key.size = unit(0.1, "inches"),
        legend.position = "right")+
  theme(legend.position = 'none')